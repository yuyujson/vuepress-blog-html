(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{557:function(n,s,a){"use strict";a.r(s);var e=a(29),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"懒汉模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#懒汉模式"}},[n._v("#")]),n._v(" 懒汉模式")]),n._v(" "),a("h3",{attrs:{id:"懒汉模式-初始版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#懒汉模式-初始版"}},[n._v("#")]),n._v(" 懒汉模式(初始版)")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("public class Singleton {\n    private static Singleton singleton;\n\n\n    private Singleton() {\n    }\n\n    public Singleton getInstance() {\n\n        synchronized (Singleton.class) {\n            if (singleton == null) {\n                singleton = new Singleton();\n            }\n        }\n        return singleton;\n    }\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br")])]),a("p",[n._v("可以看到此时的懒汉模式的性能是非常差的, 每次将对它进行加锁后进行获取. 下面将对它进行优化")]),n._v(" "),a("h3",{attrs:{id:"懒汉模式-加强版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#懒汉模式-加强版"}},[n._v("#")]),n._v(" 懒汉模式(加强版)")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("public class Singleton {\n    private static Singleton singleton;\n\n\n    private Singleton() {\n    }\n\n    public Singleton getInstance() {\n        if (singleton == null){\n            synchronized (Singleton.class) {\n                if (singleton == null) {\n                    singleton = new Singleton();\n                }\n            }\n        }\n        return singleton;\n    }\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br")])]),a("p",[n._v("在获取"),a("code",[n._v("singleton")]),n._v("的时候,只有"),a("code",[n._v("singleton")]),n._v("为空时才会对代码进行加锁,大大提高了程序的效率.\n但是我们仔细看其中的创建对象的部分, 这个单例模式真的是线程安全的吗?\n在JVM中"),a("code",[n._v("Singleton singleton = new Singleton();")]),n._v("并不是一个原子性的操作,会执行以下三个步骤")]),n._v(" "),a("ol",[a("li",[n._v("给 "),a("code",[n._v("singleton")]),n._v(" 分配空间、")]),n._v(" "),a("li",[n._v("调用 "),a("code",[n._v("Singleton")]),n._v(" 的构造函数来初始化、")]),n._v(" "),a("li",[n._v("将"),a("code",[n._v("singleton")]),n._v("对象指向分配的内存空间, "),a("code",[n._v("singleton")]),n._v("指向分配的内存空间后就不为"),a("code",[n._v("null")]),n._v("了;")])]),n._v(" "),a("p",[n._v("由于JVM的指令重排, 我们无法确保这三个步骤都在线程2在进行"),a("code",[n._v("if (singleton == null)")]),n._v("的时候已经执行了"),a("code",[n._v("2步骤")]),n._v(", 这时线程2获取到的"),a("code",[n._v("singleton")]),n._v("对象就是一个空对象,如果调用就会引发空指针异常")]),n._v(" "),a("h3",{attrs:{id:"懒汉模式-最终版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#懒汉模式-最终版"}},[n._v("#")]),n._v(" 懒汉模式(最终版)")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("public class Singleton {\n    private volatile static Singleton singleton;\n\n\n    private Singleton() {\n    }\n\n    public Singleton getInstance() {\n        if (singleton == null){\n            synchronized (Singleton.class) {\n                if (singleton == null) {\n                    singleton = new Singleton();\n                }\n            }\n        }\n        return singleton;\n    }\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br")])]),a("p",[a("code",[n._v("volatile")]),n._v(" 关键字禁止了指令重排, 可以完美解决上方因指令重拍引发的问题")]),n._v(" "),a("h2",{attrs:{id:"枚举模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#枚举模式"}},[n._v("#")]),n._v(" 枚举模式")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("public class Singleton {\n    private Singleton() {\n    }\n\n    public static enum SingletonHandler {\n        SINGLETON;\n        private Singleton singleton;\n\n        SingletonHandler() {\n            singleton = new Singleton();\n        }\n\n        public Singleton getInstance() {\n            return singleton;\n        }\n    }\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);